/* Animaci√≥n para creaci√≥n de power-ups */
.powerup-created {
  animation: pop-powerup 0.4s cubic-bezier(.2,1.8,.4,1.1);
  box-shadow: 0 0 12px 4px #fff176, 0 0 24px 8px #ffeb3b66;
  z-index: 2;
}

@keyframes pop-powerup {
  0% { transform: scale(1) rotate(0deg); filter: brightness(1.2); }
  60% { transform: scale(1.25) rotate(-8deg); filter: brightness(1.5); }
  80% { transform: scale(0.95) rotate(6deg); filter: brightness(1.3); }
  100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
}
.ufo.dynamic{ position:absolute; border-radius:50% / 60%; background:linear-gradient(180deg,#b8f9ff,#7bdfff); box-shadow:0 12px 30px rgba(0,0,0,0.35) inset, 0 6px 18px rgba(0,0,0,0.25); opacity:0; display:flex; align-items:center; justify-content:center; }
.ufo.dynamic::after{ content:''; position:absolute; bottom:-6px; width:60%; height:10px; border-radius:50%; background:radial-gradient(circle at 50% 30%, rgba(255,255,200,0.8), rgba(255,200,80,0.25)); filter:blur(6px); opacity:0.8 }

.alien.dynamic{ position:absolute; display:flex; align-items:flex-end; justify-content:center; background:linear-gradient(180deg,#6ef5b8,#2aa87a); border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.2); opacity:0; }
.alien.dynamic::after{ content:'üëΩ'; font-size:1.2em; transform:translateY(-6px); }

.astronaut.dynamic{ position:absolute; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#ffffff,#d6e8ff); border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.18); opacity:0; }
.astronaut.dynamic::after{ content:'üßë‚ÄçüöÄ'; font-size:1.1em; }

/* Use real SVG assets for UFOs and astronauts when present; keep gradient fallback */
.ufo.dynamic{
  background-image: url('assets/images/ufo.svg');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  border-radius:0; /* svg handles shape */
}
.ufo.dynamic::after{ display:none; } /* hide procedural glow when using image */

.astronaut.dynamic{
  background-image: url('assets/images/astronaut.svg');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  border-radius:0;
}
.astronaut.dynamic::after{ display:none; }

:root{
  --bg:#050514;
  --panel:rgba(6,10,20,0.6);
  --space-bg-base:#050514;
  --space-bg-accent:#8b6cff;
  --space-bg-panel:rgba(6,10,20,0.6);
  --space-bg-glow:rgba(139,108,255,0.25);
  --accent: var(--space-bg-accent);
}
*{box-sizing:border-box}
body{
  margin:0; font-family:Segoe UI, Roboto, Arial, sans-serif;
  /* much darker deep-space base */
  background: radial-gradient(ellipse at 25% 12%, rgba(24,16,48,0.28) 0%, rgba(8,6,20,0.68) 36%, rgba(2,2,6,0.99) 92%), linear-gradient(180deg,#030114 0%,#000006 100%);
  /* cool starfield tints, darker and subtler */
  background-image: radial-gradient(circle at 8% 18%, rgba(180,200,255,0.10) 0.6px, transparent 0.7px), radial-gradient(circle at 42% 66%, rgba(160,170,255,0.06) 0.7px, transparent 0.9px), radial-gradient(circle at 78% 28%, rgba(140,150,255,0.045) 0.6px, transparent 0.8px), radial-gradient(ellipse at center, rgba(10,6,26,0.14) 0%, rgba(2,3,8,0.32) 60%);
  color:#dfe9ff; display:flex; flex-direction:column; align-items:center;
  min-height:100vh;
}

/* ============================================================================
   ECONOMY SYSTEM STYLES
   ============================================================================ */

/* Economy HUD Panel */
.economy-panel {
  display: flex;
  gap: 16px;
  align-items: center;
  justify-content: center;
  padding: 12px 20px;
  background: linear-gradient(135deg, rgba(20,25,45,0.85), rgba(30,35,60,0.75));
  border-radius: 12px;
  border: 1px solid rgba(100,150,255,0.3);
  box-shadow: 0 4px 16px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
  margin-bottom: 12px;
  backdrop-filter: blur(8px);
}

.economy-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  background: rgba(10,15,30,0.6);
  border-radius: 8px;
  border: 1px solid rgba(100,150,255,0.2);
  font-size: 1.1em;
  font-weight: 600;
  color: #dfe9ff;
  transition: all 0.3s ease;
  min-width: 100px;
  justify-content: center;
}

.economy-item:hover {
  background: rgba(20,25,40,0.8);
  border-color: rgba(100,200,255,0.4);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(100,150,255,0.3);
}

.economy-item .icon {
  font-size: 1.3em;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
}

.economy-item .timer-text {
  font-size: 0.75em;
  color: #8899cc;
  margin-left: 4px;
}

#lives-display .icon {
  animation: heartbeat 2s ease-in-out infinite;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

#coins-display .icon {
  animation: coin-spin 3s linear infinite;
}

@keyframes coin-spin {
  0%, 100% { transform: rotateY(0deg); }
  50% { transform: rotateY(180deg); }
}

#stars-display .icon {
  animation: star-twinkle 2s ease-in-out infinite;
}

@keyframes star-twinkle {
  0%, 100% { opacity: 1; filter: drop-shadow(0 0 4px rgba(255,215,0,0.8)); }
  50% { opacity: 0.7; filter: drop-shadow(0 0 8px rgba(255,215,0,0.4)); }
}

/* Booster Modal */
.booster-selection {
  max-width: 600px;
  padding: 24px;
}

/* ============================================================================
   PRE-LEVEL SCREEN STYLES
   ============================================================================ */

.pre-level-panel {
  max-width: 700px;
  padding: 32px;
  background: linear-gradient(135deg, rgba(20,25,45,0.98), rgba(30,35,60,0.95));
  border: 2px solid rgba(100,150,255,0.4);
  border-radius: 16px;
  box-shadow: 0 12px 48px rgba(0,0,0,0.8);
}

.level-header {
  text-align: center;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 2px solid rgba(100,150,255,0.3);
}

.level-header h2 {
  font-size: 2.5em;
  margin: 0 0 8px 0;
  color: #fff;
  text-shadow: 0 0 20px rgba(100,200,255,0.6);
  animation: glow-pulse 2s ease-in-out infinite;
}

@keyframes glow-pulse {
  0%, 100% { text-shadow: 0 0 20px rgba(100,200,255,0.6); }
  50% { text-shadow: 0 0 30px rgba(100,200,255,0.9); }
}

.level-name {
  font-size: 1.3em;
  color: #aabbdd;
  font-style: italic;
}

.objective-preview {
  background: linear-gradient(135deg, rgba(100,150,255,0.15), rgba(80,120,200,0.1));
  border: 2px solid rgba(100,150,255,0.3);
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
  text-align: center;
}

.objective-title {
  font-size: 1.1em;
  color: #8899cc;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 12px;
  font-weight: 600;
}

.objective-description {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-size: 1.5em;
  color: #fff;
  font-weight: 600;
  margin-bottom: 12px;
  padding: 12px;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
}

.objective-icon {
  font-size: 1.8em;
  filter: drop-shadow(0 2px 6px rgba(255,215,0,0.6));
}

.objective-text {
  text-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

.moves-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 1.1em;
  color: #dfe9ff;
  margin-top: 8px;
}

.moves-icon {
  font-size: 1.3em;
}

.boosters-section {
  margin: 24px 0;
}

.boosters-section h3 {
  font-size: 1.5em;
  color: #fff;
  margin-bottom: 8px;
  text-align: center;
}

.section-subtitle {
  text-align: center;
  color: #8899cc;
  font-size: 0.95em;
  margin-bottom: 16px;
}

/* ============================================================================
   PAUSE MENU & GAME CONTROLS
   ============================================================================ */

.btn-icon {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  color: #fff;
  padding: 8px 12px;
  font-size: 1.2em;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.btn-icon:hover {
  background: rgba(255,255,255,0.2);
  transform: scale(1.05);
}

.pause-panel {
  max-width: 400px;
  padding: 32px;
  text-align: center;
}

.pause-panel h2 {
  font-size: 2em;
  margin-bottom: 24px;
  color: #fff;
}

.pause-buttons {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.booster-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 16px;
  margin: 20px 0;
}

.booster-card {
  background: linear-gradient(135deg, rgba(30,35,60,0.9), rgba(20,25,45,0.85));
  border: 2px solid rgba(100,150,255,0.3);
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.booster-card:hover {
  transform: translateY(-4px);
  border-color: rgba(100,200,255,0.6);
  box-shadow: 0 8px 24px rgba(100,150,255,0.4);
}

.booster-card.active {
  border-color: #4CAF50;
  background: linear-gradient(135deg, rgba(76,175,80,0.3), rgba(30,35,60,0.9));
  box-shadow: 0 0 20px rgba(76,175,80,0.5);
}

.booster-card.insufficient-funds {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: rgba(255,100,100,0.4);
}

.booster-icon {
  font-size: 3em;
  margin-bottom: 8px;
  display: block;
}

.booster-name {
  font-size: 1em;
  font-weight: 600;
  color: #dfe9ff;
  margin-bottom: 4px;
}

.booster-description {
  font-size: 0.85em;
  color: #aabbdd;
  margin-bottom: 8px;
}

.booster-cost {
  font-size: 0.9em;
  color: #ffd700;
  font-weight: 600;
}

.booster-inventory {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  font-size: 0.8em;
  padding: 4px 8px;
  border-radius: 12px;
  font-weight: 600;
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 20px;
}

.btn-primary {
  background: linear-gradient(135deg, #4CAF50, #45a049);
  border: none;
  color: white;
  box-shadow: 0 4px 12px rgba(76,175,80,0.4);
}

.btn-primary:hover {
  background: linear-gradient(135deg, #45a049, #3d8b40);
  box-shadow: 0 6px 16px rgba(76,175,80,0.6);
}

/* Hammer Mode Cursor */
body.hammer-mode {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><text y="28" font-size="28">üî®</text></svg>') 16 16, pointer;
}

body.hammer-mode .cell:hover {
  box-shadow: 0 0 16px rgba(255,100,100,0.8);
  transform: scale(1.1);
}

/* Economy Animations */
@keyframes coin-earned {
  0% { transform: scale(0) translateY(0); opacity: 0; }
  50% { transform: scale(1.5) translateY(-20px); opacity: 1; }
  100% { transform: scale(1) translateY(-40px); opacity: 0; }
}

@keyframes star-earned {
  0% { transform: scale(0) rotate(0deg); opacity: 0; }
  50% { transform: scale(1.3) rotate(180deg); opacity: 1; }
  100% { transform: scale(1) rotate(360deg); opacity: 0; }
}

.coin-popup {
  position: fixed;
  font-size: 2em;
  color: #ffd700;
  font-weight: bold;
  pointer-events: none;
  z-index: 9999;
  animation: coin-earned 1s ease-out forwards;
  text-shadow: 0 0 10px rgba(255,215,0,0.8);
}

.star-popup {
  position: fixed;
  font-size: 2.5em;
  pointer-events: none;
  z-index: 9999;
  animation: star-earned 1.5s ease-out forwards;
  filter: drop-shadow(0 0 15px rgba(255,215,0,0.9));
}

/* Space background layer */
#space-bg{ position:fixed; inset:0; z-index:0; pointer-events:none; background: var(--space-bg-base); }
#space-bg::before, #space-bg::after{
  content:""; position:absolute; inset:0; background-repeat:repeat;
}
#space-bg::before{
  /* subtle starfield - keep very low opacity to avoid bright bands */
  background-image: radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0)), radial-gradient(1.5px 1.5px at 50% 70%, rgba(255,255,255,0.5), rgba(255,255,255,0));
  opacity:0.12; transform:translateY(0); animation: drift 40s linear infinite;
}
#space-bg::after{
  background-image: radial-gradient(1px 1px at 10% 80%, rgba(255,255,255,0.45), rgba(255,255,255,0)), radial-gradient(1px 1px at 80% 20%, rgba(255,255,255,0.35), rgba(255,255,255,0));
  opacity:0.08; transform:translateY(0); animation: drift 60s linear infinite reverse;
}
@keyframes drift{ from{ transform:translateY(0) } to{ transform:translateY(-1200px) } }

/* distant sun */
#space-bg .sun{ position:absolute; right:8%; top:6%; width:220px; height:220px; border-radius:50%; background: radial-gradient(circle at 30% 30%, rgba(200,180,255,0.95), rgba(150,120,255,0.6) 30%, rgba(100,70,210,0.35) 60%, rgba(60,30,120,0.18) 100%); box-shadow: 0 0 120px rgba(130,100,220,0.12), inset 0 12px 40px rgba(200,180,255,0.03); opacity:0.92; transform:scale(1); filter:blur(0.8px); }

/* stars layers for parallax - ENHANCED */
#space-bg .stars-small{ position:absolute; inset:0; background-image: 
  radial-gradient(1px 1px at 5% 10%, rgba(255,255,255,0.95) 0.5px, transparent 0.6px), 
  radial-gradient(0.8px 0.8px at 70% 30%, rgba(255,255,255,0.9) 0.5px, transparent 0.6px),
  radial-gradient(1.2px 1.2px at 25% 60%, rgba(200,220,255,0.85) 0.5px, transparent 0.6px),
  radial-gradient(0.9px 0.9px at 85% 75%, rgba(200,200,255,0.92) 0.5px, transparent 0.6px); 
  background-size: 1600px 1600px; mix-blend-mode: screen; opacity:0.28; animation: drift 70s linear infinite, twinkle 8s ease-in-out infinite; }

#space-bg .stars-mid{ position:absolute; inset:0; background-image: 
  radial-gradient(1.6px 1.6px at 40% 40%, rgba(255,255,255,0.86) 0.6px, transparent 0.7px), 
  radial-gradient(2px 2px at 20% 80%, rgba(255,255,255,0.75) 0.6px, transparent 0.8px),
  radial-gradient(1.5px 1.5px at 60% 20%, rgba(220,240,255,0.88) 0.6px, transparent 0.7px),
  radial-gradient(1.8px 1.8px at 35% 35%, rgba(180,220,255,0.80) 0.6px, transparent 0.7px);
  background-size:2200px 2200px; mix-blend-mode: screen; opacity:0.22; animation: drift 120s linear infinite reverse, twinkle 10s ease-in-out infinite; }

/* nebula and milky-way layers for richer space look - ENHANCED */
#space-bg .nebula{ position:absolute; inset:-10% -20%; pointer-events:none; mix-blend-mode:normal; filter:blur(28px) saturate(1.15); opacity:0.92; transform:translateZ(0); }
/* darker, richer nebulae with more color variation */
#space-bg .nebula.neb1{ 
  background: 
    radial-gradient(circle at 20% 35%, rgba(150,100,230,0.28), rgba(100,60,180,0.12) 22%, transparent 46%),
    radial-gradient(circle at 74% 70%, rgba(120,80,200,0.16), rgba(60,40,140,0.06) 20%, transparent 44%),
    radial-gradient(ellipse at 40% 40%, rgba(80,120,200,0.08), transparent 50%);
  animation: nebMove 36s linear infinite; 
}
#space-bg .nebula.neb2{ 
  background: 
    radial-gradient(circle at 60% 30%, rgba(180,130,255,0.18), rgba(90,120,220,0.10) 20%, transparent 44%),
    radial-gradient(circle at 30% 72%, rgba(120,160,240,0.12), rgba(50,80,150,0.06) 26%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(60,100,200,0.06), transparent 60%);
  animation: nebMove 48s linear infinite reverse; 
}
#space-bg .milkyway{ position:absolute; left:-20%; top:8%; width:160%; height:60%; pointer-events:none; background: 
  linear-gradient(90deg, rgba(160,140,240,0.05) 0%, rgba(140,120,240,0.08) 30%, rgba(100,100,180,0.04) 60%),
  radial-gradient(ellipse at 30% 50%, rgba(180,150,255,0.04), transparent 50%);
  transform: rotate(-12deg); filter:blur(32px) contrast(1.1) saturate(1.05); opacity:0.48; mix-blend-mode:normal; animation: nebMove 90s linear infinite; }

/* Concept layer placeholders (default hidden, fade via data-concept on #space-bg) */
.bg-concept-layers{ position:absolute; inset:0; pointer-events:none; z-index:0; }
.bg-concept-layers > div{ position:absolute; pointer-events:none; opacity:0; transition:opacity 700ms ease, transform 900ms cubic-bezier(.2,.9,.2,1); will-change:opacity, transform; mix-blend-mode:normal; z-index:0 }
.bg-concept-layers .silhouette{ left:50%; transform:translateX(-50%) translateY(8%); width:120%; height:48%; filter:blur(4px) saturate(0.85) contrast(0.9); background-size:contain; background-repeat:no-repeat; background-position:center bottom; }
.bg-concept-layers .silhouette.hangar{ background-image: url('assets/images/structure.svg'); border-radius:8px; bottom:12%; }
.bg-concept-layers .silhouette.base{ background-image: url('assets/images/spaceship_v2.svg'); border-radius:6px; bottom:6%; height:46%; width:120%; background-position:center bottom; background-size:contain; }
.bg-concept-layers .astronauts{ left:12%; bottom:8%; width:164px; height:164px; background-image: url('assets/images/astronaut_v2.svg'); background-size:contain; background-repeat:no-repeat; background-position:center bottom; border-radius:40px; filter:blur(0.06px) saturate(1.0); transform-origin:center; }
.bg-concept-layers .drones{ right:8%; bottom:26%; width:96px; height:48px; background-image: url('assets/images/ufo_v2.svg'); background-size:contain; background-repeat:no-repeat; background-position:center bottom; filter:blur(0.6px); border-radius:6px; }

/* Base: hide these by default, show per concept */
#space-bg[data-concept="concept-a"] .bg-concept-layers .silhouette.hangar{ opacity:0.92; transform:translateX(-50%) translateY(0); }
#space-bg[data-concept="concept-a"] .bg-concept-layers .astronauts{ opacity:0.95; transform: translateY(-6px) scale(1); }
#space-bg[data-concept="concept-a"] .bg-concept-layers .drones{ opacity:0.46; transform: translateX(0); }

#space-bg[data-concept="concept-b"] .bg-concept-layers .silhouette.hangar{ opacity:0.22; }
#space-bg[data-concept="concept-b"] .bg-concept-layers .silhouette.base{ opacity:0.34; }
#space-bg[data-concept="concept-b"] .bg-concept-layers .astronauts{ opacity:0.26; }
#space-bg[data-concept="concept-b"] .bg-concept-layers .drones{ opacity:0.22; }

#space-bg[data-concept="concept-c"] .bg-concept-layers .silhouette.base{ opacity:0.92; transform:translateX(-50%) translateY(-2%); }
#space-bg[data-concept="concept-c"] .bg-concept-layers .astronauts{ opacity:0.86; transform: translateY(-4px) scale(0.96); }
#space-bg[data-concept="concept-c"] .bg-concept-layers .drones{ opacity:0.78; transform: translateX(0) scale(0.9); }

/* interactions: spaceship subtle approach, astronaut wave, UFO beam */
@keyframes ship-approach{
  0%{ transform: translate(-12px, 8px) scale(0.98) }
  50%{ transform: translate(6px, -8px) scale(1.01) }
  100%{ transform: translate(-12px, 8px) scale(0.98) }
}
@keyframes astro-wave{
  0%{ transform: translateY(0) rotate(0deg) }
  40%{ transform: translateY(-6px) rotate(-4deg) }
  60%{ transform: translateY(-6px) rotate(6deg) }
  100%{ transform: translateY(0) rotate(0deg) }
}
@keyframes ufo-beam{ 0%{ opacity:0 } 30%{ opacity:0.0 } 50%{ opacity:0.24 } 90%{ opacity:0 } 100%{ opacity:0 } }

#space-bg[data-concept="concept-a"] .bg-concept-layers .silhouette.base{ animation: ship-approach 9s ease-in-out infinite; }
#space-bg[data-concept="concept-a"] .bg-concept-layers .astronauts{ animation: astro-wave 6.6s ease-in-out infinite; transform-origin:center bottom; }
#space-bg[data-concept="concept-a"] .bg-concept-layers .drones::after{ content:''; position:absolute; left:50%; top:40%; width:18px; height:80px; transform:translateX(-50%); background: linear-gradient(180deg, rgba(180,220,255,0.14), rgba(180,220,255,0.06) 30%, rgba(180,220,255,0.0) 70%); opacity:0; animation: ufo-beam 10s linear infinite; }

/* Subtle drone/astronaut micro-animations (reduced motion respects prefers-reduced-motion) */
@keyframes drone-loop{ 0%{ transform:translateX(0) } 50%{ transform:translateX(-8px) } 100%{ transform:translateX(0) } }
@keyframes astro-bob{ 0%{ transform:translateY(0) } 50%{ transform:translateY(-6px) } 100%{ transform:translateY(0) } }
#space-bg[data-concept="concept-a"] .bg-concept-layers .astronauts{ animation: astro-bob 6s ease-in-out infinite; }
#space-bg[data-concept="concept-c"] .bg-concept-layers .drones{ animation: drone-loop 8s linear infinite; }
@media (prefers-reduced-motion: reduce){
  #space-bg .nebula, #space-bg .stars-small, #space-bg .stars-mid, #space-bg .ship, #space-bg .planet, .bg-concept-layers > div{ animation:none !important; transition:none !important; }
}

/* end of debug rules (removed) */

@keyframes nebMove{ 0%{ transform: translateX(0) translateY(0) rotate(0deg) } 50%{ transform: translateX(-6%) translateY(-3%) rotate(0.2deg) } 100%{ transform: translateX(0) translateY(0) rotate(0deg) } }
@keyframes twinkle{ 0%,100%{ opacity:0.9 } 50%{ opacity:0.65 } }

/* shooting star + twinkle styles */
.shooting-star{ position:absolute; left:0; top:0; background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(200,220,255,0.6) 40%, rgba(160,120,255,0.35)); filter:blur(1px); border-radius:6px; pointer-events:none; transform:translateX(0) rotate(0deg); z-index:20; mix-blend-mode:screen }
.twinkle{ position:absolute; background:radial-gradient(circle, rgba(255,255,255,0.98) 0%, rgba(200,220,255,0.7) 30%, rgba(160,120,255,0.15) 60%, transparent 100%); border-radius:50%; pointer-events:none; z-index:10; opacity:0.0 }
@keyframes twinkle{ 0%{ transform:scale(0.7); opacity:0.0 } 40%{ opacity:0.9; transform:scale(1.2) } 100%{ opacity:0.0; transform:scale(0.6) } }

/* Level-up overlay and confetti */
.level-overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9999; pointer-events:none; }
.level-popup{ background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border-radius:12px; padding:20px 28px; color:#061028; font-weight:800; font-size:28px; box-shadow:0 10px 30px rgba(0,0,0,0.5); transform:scale(0.8); animation: popup 700ms cubic-bezier(.2,.9,.2,1) forwards; }
@keyframes popup{ to{ transform:scale(1); } }
.confetti{ position:fixed; width:10px; height:16px; z-index:10000; pointer-events:none; opacity:0.95; transform: translateY(-10vh); }
@keyframes confetti-fall{ to{ transform: translateY(120vh) rotate(720deg); opacity:0.9; } }

/* Planets and ships layered as decorative elements */
#space-bg .planet, #space-bg .ship{ position:absolute; pointer-events:none; will-change:transform, opacity; }

/* Planets - ENHANCED with more glow */
#space-bg .planet{ border-radius:50%; box-shadow:0 8px 30px rgba(0,0,0,0.5) inset; opacity:0.98; filter:drop-shadow(0 0 20px rgba(139,108,255,0.25)) drop-shadow(0 0 40px rgba(139,108,255,0.08)); }
#space-bg .planet.p1{ width:200px; height:200px; left:8%; top:8%; background: radial-gradient(circle at 30% 30%, #a586ff, #7a5bdb 38%, #3d2a5f 100%); transform-origin:center; animation: slow-rotate 48s linear infinite, floaty 8s ease-in-out infinite; box-shadow: 0 8px 30px rgba(0,0,0,0.7) inset, 0 0 80px rgba(165,134,255,0.3), 0 0 160px rgba(165,134,255,0.1); }
#space-bg .planet.p2{ width:130px; height:130px; right:6%; top:20%; background: radial-gradient(circle at 30% 30%, #b9a4ff, #7e6fd8 40%, #2d1d50 100%); animation: slow-rotate 60s linear infinite reverse, floaty 10s ease-in-out infinite; opacity:0.97; box-shadow: 0 8px 30px rgba(0,0,0,0.6) inset, 0 0 60px rgba(185,164,255,0.25), 0 0 120px rgba(185,164,255,0.08); }
#space-bg .planet.p3{ width:110px; height:110px; left:40%; bottom:6%; background: radial-gradient(circle at 25% 25%, #8fdbff, #3eabd0 40%, #0d3d52 100%); animation: slow-rotate 80s linear infinite, floaty 7s ease-in-out infinite; opacity:0.98; box-shadow: 0 8px 30px rgba(0,0,0,0.6) inset, 0 0 70px rgba(143,219,255,0.3), 0 0 140px rgba(143,219,255,0.1); }

@keyframes slow-rotate{ from{ transform:rotate(0deg) } to{ transform:rotate(360deg) } }
@keyframes floaty{ 0%{ transform:translateY(0) } 50%{ transform:translateY(-14px) } 100%{ transform:translateY(0) } }

/* Ships ‚Äî simple triangular silhouettes with enhanced glow */
#space-bg .ship{ width:64px; height:24px; top:40%; left:-10%; opacity:0.98; transform:translateX(0) rotate(6deg); filter:drop-shadow(0 0 15px rgba(139,220,255,0.4)); }
#space-bg .ship.s1{ background: linear-gradient(90deg, rgba(255,255,255,0.95) 0%, rgba(200,240,255,0.90) 40%, rgba(180,150,255,0.75) 100%); clip-path: polygon(0 50%, 70% 0, 100% 50%, 70% 100%); box-shadow:0 6px 18px rgba(80,140,200,0.18), 0 0 30px rgba(139,220,255,0.25); animation: ship-glide 18s linear infinite; } 
#space-bg .ship.s2{ width:48px; height:20px; top:62%; left:110%; transform:translateX(0) rotate(-8deg); background: linear-gradient(90deg, rgba(255,240,220,0.98) 0%, rgba(255,200,220,0.90) 60%); clip-path: polygon(0 50%, 60% 0, 100% 50%, 60% 100%); animation: ship-glide-rev 22s linear infinite; opacity:0.97; box-shadow: 0 6px 18px rgba(200,100,150,0.15), 0 0 25px rgba(255,150,200,0.2); }
#space-bg .ship.dynamic{ position:absolute; border-radius:4px; box-shadow:0 10px 18px rgba(0,0,0,0.35); opacity:0; transform:translateX(0); }
.ship.dynamic.rev{ transform:translateX(0) rotate(-6deg); }

/* asteroids */
#space-bg .asteroid{ position:absolute; border-radius:50%; background:radial-gradient(circle at 30% 30%, #d9d9d9, #777 40%, #433 100%); box-shadow: 0 4px 10px rgba(0,0,0,0.45) inset; opacity:0; }

/* control icon improvements */
.audio-controls .btn{ display:inline-flex; align-items:center; gap:8px }
.audio-controls .btn .icon{ font-size:14px }


@keyframes ship-glide{ 0%{ transform:translateX(-120vw) rotate(4deg); opacity:0 } 8%{ opacity:1 } 50%{ transform:translateX(40vw) rotate(6deg); opacity:1 } 100%{ transform:translateX(120vw) rotate(10deg); opacity:0 } }
@keyframes ship-glide-rev{ 0%{ transform:translateX(120vw) rotate(-6deg); opacity:0 } 8%{ opacity:1 } 50%{ transform:translateX(-20vw) rotate(-8deg); opacity:1 } 100%{ transform:translateX(-140vw) rotate(-12deg); opacity:0 } }

/* Moving ships - additional animations */
.moving-ship{ position:absolute; pointer-events:none; z-index:5; }
.ship-1{
  width:80px; height:32px; top:20%; left:-100px;
  background: linear-gradient(90deg, rgba(255,255,255,0.88) 0%, rgba(200,240,255,0.85) 40%, rgba(150,180,255,0.6) 100%);
  clip-path: polygon(0 50%, 75% 0, 100% 50%, 75% 100%);
  box-shadow: 0 8px 25px rgba(80,140,200,0.2), 0 0 35px rgba(139,200,255,0.3);
  animation: moving-ship-1 25s linear infinite;
  filter: drop-shadow(0 0 12px rgba(139,200,255,0.4));
}

.ship-2{
  width:65px; height:26px; top:65%; right:-100px;
  background: linear-gradient(90deg, rgba(255,200,220,0.92) 0%, rgba(255,150,180,0.85) 60%);
  clip-path: polygon(0 50%, 70% 0, 100% 50%, 70% 100%);
  box-shadow: 0 8px 20px rgba(200,100,150,0.18), 0 0 30px rgba(255,150,200,0.25);
  animation: moving-ship-2 28s linear infinite;
  filter: drop-shadow(0 0 10px rgba(255,150,200,0.4));
}

@keyframes moving-ship-1 {
  0% { transform: translateX(-100px) translateY(0) rotate(0deg); opacity: 0; }
  5% { opacity: 0.9; }
  50% { transform: translateX(45vw) translateY(-20px) rotate(3deg); opacity: 1; }
  95% { opacity: 0.8; }
  100% { transform: translateX(100vw) translateY(0) rotate(5deg); opacity: 0; }
}

@keyframes moving-ship-2 {
  0% { transform: translateX(100vw) translateY(0) rotate(0deg); opacity: 0; }
  5% { opacity: 0.85; }
  50% { transform: translateX(-30vw) translateY(15px) rotate(-4deg); opacity: 1; }
  95% { opacity: 0.75; }
  100% { transform: translateX(-100vw) translateY(0) rotate(-8deg); opacity: 0; }
}

/* Moving astronauts */
.moving-astronaut{ position:absolute; pointer-events:none; z-index:4; border-radius: 50%; }
.astro-1{
  width:120px; height:120px; top:30%; left:-60px;
  background: radial-gradient(circle at 30% 30%, rgba(100,220,255,0.4), rgba(100,200,255,0.1));
  box-shadow: 0 0 50px rgba(100,220,255,0.3), inset 0 0 30px rgba(100,220,255,0.15);
  animation: moving-astro-1 22s ease-in-out infinite;
}

.astro-2{
  width:100px; height:100px; top:55%; right:-50px;
  background: radial-gradient(circle at 30% 30%, rgba(180,150,255,0.35), rgba(180,150,255,0.08));
  box-shadow: 0 0 45px rgba(180,150,255,0.28), inset 0 0 25px rgba(180,150,255,0.12);
  animation: moving-astro-2 26s ease-in-out infinite;
}

@keyframes moving-astro-1 {
  0% { transform: translateX(-60px) translateY(0) scale(0.8); opacity: 0; }
  10% { opacity: 0.7; }
  45% { transform: translateX(35vw) translateY(-30px) scale(1); opacity: 1; }
  55% { transform: translateX(45vw) translateY(20px) scale(1.05); opacity: 1; }
  90% { opacity: 0.6; }
  100% { transform: translateX(100vw) translateY(0) scale(0.8); opacity: 0; }
}

@keyframes moving-astro-2 {
  0% { transform: translateX(100vw) translateY(0) scale(0.85); opacity: 0; }
  10% { opacity: 0.65; }
  40% { transform: translateX(-25vw) translateY(25px) scale(1); opacity: 1; }
  60% { transform: translateX(-40vw) translateY(-15px) scale(1.08); opacity: 1; }
  90% { opacity: 0.55; }
  100% { transform: translateX(-100vw) translateY(0) scale(0.85); opacity: 0; }
}

/* subtle parallax layers for stars (small, mid, large) */
#space-bg .stars-layer{ position:absolute; inset:0; background-repeat:repeat; pointer-events:none; opacity:0.06 }


/* subtle nebula glow behind game root */
#game-root{ position:relative; }
#game-root::before{ content:""; position:absolute; inset:-60px; z-index:-1; border-radius:12px; 
  /* stronger, cool-toned vignette behind the board to guarantee contrast */
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.62) 0%, rgba(6,8,12,0.42) 30%, rgba(10,12,18,0.18) 60%, transparent 85%);
}
/* silver/metallic inner rim for stronger contrast */
/* inner rim + specular highlight: radial (sun reflection) + subtle specular stripe */
#game-root::after{
  content:"";
  position:absolute; inset:0; z-index:0; border-radius:12px; pointer-events:none;
  /* softened, cool inner rim for metallic reflection (low intensity) */
  box-shadow: inset 0 0 36px rgba(200,220,255,0.04);
  mix-blend-mode:screen;
  animation: rim-pulse 4.4s ease-in-out infinite;
  /* specular highlights placed over the panel to simulate sunlight from top-right; cool tint */
  background-image:
    radial-gradient(circle at 86% 12%, rgba(200,220,255,0.12), rgba(200,220,255,0.04) 12%, rgba(200,220,255,0) 28%),
    linear-gradient(135deg, rgba(200,220,255,0.04) 0%, rgba(200,220,255,0.01) 18%, rgba(200,220,255,0) 36%);
  background-repeat:no-repeat;
}

/* Side figure styles: modern geometric design */
.side-figure{
  position:fixed;
  top:50%; transform:translateY(-50%);
  width:160px; height:160px;
  pointer-events:none; z-index:0; opacity:0.75;
  display:flex; align-items:center; justify-content:center;
}

.side-figure.left{ 
  left: calc(50% - 500px);
  background: linear-gradient(135deg, var(--space-bg-accent) 0%, rgba(0, 0, 0, 0.45) 100%);
  border-radius:30%;
  box-shadow: 0 0 60px rgba(255,255,255,0.1), inset 0 0 40px rgba(255,255,255,0.06);
  animation: float-left 6s ease-in-out infinite;
}

.side-figure.right{ 
  left: calc(50% + 340px);
  background: linear-gradient(225deg, var(--space-bg-glow) 0%, rgba(0, 0, 0, 0.45) 100%);
  border-radius:25%;
  box-shadow: 0 0 60px rgba(255,255,255,0.08), inset 0 0 40px rgba(255,255,255,0.05);
  animation: float-right 7s ease-in-out infinite;
}

.side-figure.left::before, .side-figure.left::after {
  content: '';
  position: absolute;
  border-radius: 50%;
}

.side-figure.left::before {
  width: 100px;
  height: 100px;
  background: radial-gradient(circle at 30% 30%, rgba(200,160,255,0.4), rgba(139,108,255,0.1));
  box-shadow: 0 0 40px rgba(139,108,255,0.3);
}

.side-figure.left::after {
  width: 50px;
  height: 50px;
  top: 20px;
  right: 20px;
  background: radial-gradient(circle at 30% 30%, rgba(200,160,255,0.6), rgba(139,108,255,0.2));
  box-shadow: 0 0 25px rgba(139,108,255,0.4);
}

.side-figure.right::before, .side-figure.right::after {
  content: '';
  position: absolute;
  border-radius: 50%;
}

.side-figure.right::before {
  width: 110px;
  height: 110px;
  background: radial-gradient(circle at 30% 30%, rgba(150,210,255,0.4), rgba(100,200,255,0.1));
  box-shadow: 0 0 45px rgba(100,200,255,0.3);
}

.side-figure.right::after {
  width: 55px;
  height: 55px;
  bottom: 15px;
  left: 15px;
  background: radial-gradient(circle at 30% 30%, rgba(150,210,255,0.6), rgba(100,200,255,0.2));
  box-shadow: 0 0 30px rgba(100,200,255,0.4);
}

@keyframes float-left {
  0%, 100% { transform: translateY(-50%) translateX(0); }
  50% { transform: translateY(-50%) translateX(-15px); }
}

@keyframes float-right {
  0%, 100% { transform: translateY(-50%) translateX(0); }
  50% { transform: translateY(-50%) translateX(15px); }
}

#game-root{ position:relative; z-index:2; }
header{padding:20px 16px; text-align:center}
h1{margin:0;font-size:20px}
.subtitle{margin:6px 0 0; color:#a9c1ff}
main{width:100%; max-width:760px; padding:12px}
#game-root{
  /* metallic panel: gunmetal base with subtle specular sheen */
  background: linear-gradient(180deg, #2b3034 0%, #3b4146 35%, #2f3539 100%);
  background-image: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(40,44,48,0.6)), linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0) 30%);
  -webkit-backdrop-filter: blur(6px) saturate(110%);
  backdrop-filter: blur(6px) saturate(110%);
  background-color: var(--space-bg-panel);
  border:1px solid rgba(220,225,230,0.06);
  border-radius:12px; padding:16px;
  box-shadow: 0 10px 36px rgba(0,0,0,0.65) inset, 0 18px 60px rgba(0,0,0,0.6), 0 0 28px rgba(255,255,255,0.06), 0 0 56px rgba(220,230,240,0.04);
  position:relative; overflow:hidden;
}

@keyframes rim-pulse{
  0%{ box-shadow: inset 0 0 28px rgba(255,255,255,0.06); }
  50%{ box-shadow: inset 0 0 64px rgba(255,255,255,0.14); }
  100%{ box-shadow: inset 0 0 28px rgba(255,255,255,0.06); }
}
#board-placeholder{padding:20px; text-align:center}

#panel{display:none}
.panel{background: var(--space-bg-panel); padding:10px; border-radius:10px; margin-top:12px; backdrop-filter: blur(4px); border:1px solid rgba(255,255,255,0.02);}
#hud{display:flex; gap:12px; align-items:center; justify-content:space-between; padding:6px}
#score, #moves{font-weight:600}

.cell.selected{outline:3px solid rgba(139,108,255,0.28); transform:scale(1.03)}
.cell.power-striped::after{content:'\2192'; position:absolute; color:#ffd966; font-size:14px}
.cell.power-wrapped{ font-weight: bold; }
.cell.power-striped{ font-weight: bold; }
.cell.power-colorbomb{ font-weight: bold; box-shadow:0 0 8px #fff6; }
/* Bomb power visuals */
.cell.power-bomb{ font-weight: bold; }
.cell.bomb-primed{ animation: bomb-pulse 440ms ease-in-out infinite; box-shadow: 0 0 18px 6px rgba(200,130,255,0.18), 0 0 30px rgba(120,60,220,0.12) inset; }
.cell.hammer-activated{ animation: hammer-pulse 300ms ease-in-out infinite; box-shadow: 0 0 12px 4px rgba(255,215,0,0.3), 0 0 20px rgba(255,165,0,0.2) inset; }
@keyframes bomb-pulse{ 0%{ transform:scale(1) } 50%{ transform:scale(1.08) } 100%{ transform:scale(1) } }
@keyframes hammer-pulse{ 0%{ transform:scale(1) rotate(0deg) } 25%{ transform:scale(1.05) rotate(-2deg) } 75%{ transform:scale(1.05) rotate(2deg) } 100%{ transform:scale(1) rotate(0deg) } }

.grid{position:relative}
.cell{transition:transform 220ms ease, opacity 180ms ease; position:relative}

/* swap animation helper */
.anim-swap{will-change:transform; transition:transform 220ms cubic-bezier(.2,.8,.2,1)}
.anim-remove{transition:opacity 220ms ease, transform 260ms ease; opacity:0; transform:scale(0.85)}

/* Preview panel */
#preview-panel{margin-top:12px}
#preview-controls{display:flex; gap:8px; align-items:center}

/* Mobile touch improvements */
@media (max-width:520px){
  #hud{flex-direction:column; align-items:flex-start}
  .cell{touch-action:none}
}

.grid{display:grid; gap:6px; justify-content:center; align-content:center;}
.cell{width:56px; height:56px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:28px; cursor:pointer; user-select:none;}
.cell.empty{background:transparent}
.cell.basic{background:linear-gradient(180deg, #1b2b44, #112036); box-shadow:0 2px 0 rgba(0,0,0,0.4) inset;}

#controls{margin-top:12px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center}
.btn{background:var(--accent); color:#ffffff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; box-shadow: 0 6px 12px rgba(100,60,180,0.12); font-size:14px; font-weight:500; transition:all 0.2s ease}
.btn:hover{transform:translateY(-2px); box-shadow: 0 8px 16px rgba(100,60,180,0.20)}
.btn:active{transform:translateY(0); box-shadow: 0 4px 8px rgba(100,60,180,0.10)} 

/* audio controls */
.audio-controls{display:flex; gap:8px; align-items:center}
.audio-controls label{font-size:13px; color:rgba(230,240,255,0.9)}
.audio-controls input[type=range]{width:110px}

@media(max-width:520px){
  .cell{width:42px;height:42px;font-size:20px}
}

/* Theme overrides via data-theme on <body> */
body[data-theme="deep"]{
  /* Darker Deep Space variant (avoid beige) */
  background: radial-gradient(ellipse at 25% 12%, rgba(18,12,36,0.36) 0%, rgba(8,6,18,0.78) 40%, rgba(2,2,6,0.99) 92%), linear-gradient(180deg,#04021a 0%,#000005 100%);
}
body[data-theme="deep"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(90,60,170,0.20), rgba(50,30,120,0.10) 22%, transparent 46%); }
body[data-theme="deep"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(110,80,200,0.12), rgba(60,40,150,0.06) 20%, transparent 44%); }

body[data-theme="violet"]{
  background: radial-gradient(ellipse at 25% 12%, rgba(38,12,60,0.36) 0%, rgba(8,6,18,0.76) 40%, rgba(2,2,6,0.99) 92%), linear-gradient(180deg,#070016 0%,#01000a 100%);
}
body[data-theme="violet"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 18% 38%, rgba(160,100,240,0.22), rgba(90,50,170,0.12) 20%, transparent 48%); }
body[data-theme="violet"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 60% 28%, rgba(200,140,255,0.12), rgba(90,80,210,0.06) 20%, transparent 44%); }

body[data-theme="azure"]{
  background: radial-gradient(ellipse at 20% 10%, rgba(6,24,48,0.30) 0%, rgba(6,10,22,0.78) 42%, rgba(2,4,10,1) 95%), linear-gradient(180deg,#021428 0%,#000613 100%);
}
body[data-theme="azure"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(80,150,220,0.14), rgba(40,90,160,0.08) 22%, transparent 46%); }
body[data-theme="azure"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(120,180,255,0.10), rgba(60,120,180,0.06) 20%, transparent 44%); }

body[data-theme="midnight"]{
  background: radial-gradient(ellipse at 25% 12%, rgba(6,6,12,0.40) 0%, rgba(2,2,6,0.98) 80%), linear-gradient(180deg,#000006 0%,#000001 100%);
}
body[data-theme="midnight"] #space-bg .nebula.neb1{ opacity:0.55; }
body[data-theme="midnight"] #space-bg .nebula.neb2{ opacity:0.45; }
body[data-theme="midnight"] #space-bg .milkyway{ opacity:0.38 }

body[data-theme="emerald"]{
  background: radial-gradient(ellipse at 25% 15%, rgba(6,22,18,0.28) 0%, rgba(2,8,10,0.78) 40%, rgba(0,2,2,0.98) 95%), linear-gradient(180deg,#021917 0%,#000712 100%);
}
body[data-theme="emerald"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(80,200,160,0.12), rgba(20,80,80,0.06) 22%, transparent 46%); }
body[data-theme="emerald"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(120,200,180,0.08), rgba(60,120,100,0.04) 20%, transparent 44%); }

/* New themes */
body[data-theme="cosmic"]{
  background: radial-gradient(ellipse at 30% 20%, rgba(40,15,50,0.4) 0%, rgba(8,2,15,0.85) 45%, rgba(2,0,5,0.99) 95%), linear-gradient(180deg,#0a0515 0%,#000508 100%);
}
body[data-theme="cosmic"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 25% 40%, rgba(200,80,220,0.18), rgba(100,40,140,0.10) 24%, transparent 50%); }
body[data-theme="cosmic"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 65% 25%, rgba(150,100,200,0.14), rgba(80,60,130,0.08) 22%, transparent 46%); }
body[data-theme="cosmic"] #space-bg .milkyway{ opacity:0.25; }

body[data-theme="aurora"]{
  background: radial-gradient(ellipse at 20% 25%, rgba(30,60,80,0.35) 0%, rgba(10,20,35,0.80) 40%, rgba(2,5,12,0.98) 95%), linear-gradient(180deg,#0f1f3a 0%,#050a1a 100%);
}
body[data-theme="aurora"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 18% 40%, rgba(100,200,255,0.16), rgba(40,120,180,0.10) 20%, transparent 48%); }
body[data-theme="aurora"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 62% 28%, rgba(150,220,255,0.12), rgba(80,150,200,0.07) 22%, transparent 44%); }
body[data-theme="aurora"] #space-bg .milkyway{ opacity:0.4; filter: hue-rotate(180deg); }

body[data-theme="blackhole"]{
  background: radial-gradient(ellipse at 50% 50%, rgba(10,5,20,0.2) 0%, rgba(3,1,8,0.92) 50%, rgba(0,0,2,0.99) 100%), linear-gradient(180deg,#050005 0%,#000000 100%);
}
body[data-theme="blackhole"] #space-bg .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(120,60,180,0.22), rgba(60,30,100,0.12) 22%, transparent 46%); opacity:0.8; }
body[data-theme="blackhole"] #space-bg .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(100,50,150,0.16), rgba(50,25,80,0.08) 20%, transparent 44%); opacity:0.75; }
body[data-theme="blackhole"] #space-bg .milkyway{ opacity:0.15; }

/* Theme select styling to match UI */
.theme-controls select{ 
  /* Closed select looks like other purple buttons: dark purple gradient + white text */
  background: linear-gradient(180deg, #8a4dff, #6b2cff);
  border:1px solid rgba(255,255,255,0.06);
  padding:6px 10px; 
  color:#fff; 
  border-radius:8px; 
  box-shadow: 0 1px 0 rgba(0,0,0,0.15) inset;
  -webkit-appearance: none; -moz-appearance: none; appearance: none;
}
.theme-controls select option{ color:#111; background: #fff; }

/* Add a small arrow indicator to match button feel (pure CSS) */
.theme-controls select{ background-image: linear-gradient(180deg, #8a4dff, #6b2cff),
  url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'><path fill='white' d='M0 0l5 6 5-6z'/></svg>");
  background-repeat: no-repeat; background-position: right 8px center; background-size: 12px 8px;
  padding-right: 30px;
}

/* Also support applying theme directly on #space-bg for immediate visual feedback */
#space-bg[data-theme="violet"] .nebula.neb1{ background: radial-gradient(circle at 18% 38%, rgba(160,100,240,0.22), rgba(90,50,170,0.12) 20%, transparent 48%); }
#space-bg[data-theme="violet"] .nebula.neb2{ background: radial-gradient(circle at 60% 28%, rgba(200,140,255,0.12), rgba(90,80,210,0.06) 20%, transparent 44%); }
#space-bg[data-theme="azure"] .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(80,150,220,0.14), rgba(40,90,160,0.08) 22%, transparent 46%); }
#space-bg[data-theme="azure"] .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(120,180,255,0.10), rgba(60,120,180,0.06) 20%, transparent 44%); }
#space-bg[data-theme="midnight"] .nebula.neb1{ opacity:0.55; }
#space-bg[data-theme="midnight"] .nebula.neb2{ opacity:0.45; }
#space-bg[data-theme="midnight"] .milkyway{ opacity:0.38 }
#space-bg[data-theme="emerald"] .nebula.neb1{ background: radial-gradient(circle at 20% 35%, rgba(80,200,160,0.12), rgba(20,80,80,0.06) 22%, transparent 46%); }
#space-bg[data-theme="emerald"] .nebula.neb2{ background: radial-gradient(circle at 60% 30%, rgba(120,200,180,0.08), rgba(60,120,100,0.04) 20%, transparent 44%); }

/* Hint highlight style */
.cell.hint{ box-shadow: 0 0 18px 6px rgba(255,200,80,0.06) inset, 0 0 18px rgba(255,200,80,0.9); animation: hint-pulse 1.2s ease-in-out infinite; }
@keyframes hint-pulse{ 0%{ transform:scale(1); filter: drop-shadow(0 0 0 rgba(255,200,80,0.0)); } 50%{ transform:scale(1.06); filter: drop-shadow(0 0 18px rgba(255,200,80,0.45)); } 100%{ transform:scale(1); filter: drop-shadow(0 0 0 rgba(255,200,80,0.0)); } }

/* NEW: Match / Power Animations (tuned) */
.cell-match-pop{ animation: cell-match-zoom 360ms cubic-bezier(.2,.8,.2,1) forwards; will-change: transform, opacity, filter; }
@keyframes cell-match-zoom{
  0%{ transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,255,255,0)); }
  30%{ transform: scale(1.24); filter: drop-shadow(0 18px 36px rgba(160,120,255,0.16)); }
  60%{ transform: scale(0.9); opacity:0.96; }
  100%{ transform: scale(1); opacity:0; }
}

.cell-power-create{ animation: cell-power-bloom 520ms cubic-bezier(.15,.9,.2,1) forwards; will-change: transform, filter, opacity; }
@keyframes cell-power-bloom{
  0%{ transform: scale(0.9); filter: blur(0px) brightness(1); }
  50%{ transform: scale(1.4); filter: blur(1px) brightness(1.22); }
  100%{ transform: scale(1); }
}

.cell-bomb-explode{ animation: bomb-explode-anim 560ms cubic-bezier(.22,.85,.2,1) forwards; will-change: transform, opacity, filter; }
@keyframes bomb-explode-anim{
  0%{ transform: scale(1); filter: brightness(1); }
  28%{ transform: scale(1.3); filter: blur(0.8px) brightness(1.28); }
  60%{ transform: scale(0.86); opacity:0.9; }
  100%{ transform: scale(0.28); opacity:0; }
}

/* Swap tap micro-feedback */
.cell-swap-tap{ animation: cell-swap-pop 160ms cubic-bezier(.2,.9,.2,1) forwards; }
@keyframes cell-swap-pop{ 0%{ transform: scale(1) } 50%{ transform: scale(1.06) } 100%{ transform: scale(1) } }

/* Hint ping */
.cell-hint-ping::after{ content:''; position:absolute; left:50%; top:50%; width:48px; height:48px; transform:translate(-50%,-50%); border-radius:50%; box-shadow:0 0 18px rgba(255,220,120,0.12); opacity:0; animation: hint-ring 820ms ease-out forwards; }
@keyframes hint-ring{ 0%{ transform: translate(-50%,-50%) scale(0.6); opacity:0.6 } 100%{ transform: translate(-50%,-50%) scale(1.6); opacity:0 } }

/* Particles for match/power bursts (pooled DOM nodes) */
.particle{ position:absolute; pointer-events:none; width:8px; height:8px; border-radius:50%; transform-origin:center; opacity:1; will-change: transform, opacity, filter; z-index:30; mix-blend-mode:screen; box-shadow: 0 2px 10px rgba(0,0,0,0.45), 0 0 8px rgba(255,255,255,0.03) inset; border: 1px solid rgba(255,255,255,0.03); }
.particle.small{ width:6px; height:6px }
.particle.tiny{ width:4px; height:4px }

/* Settings controls (small) */
.settings-controls{ display:inline-flex; gap:12px; align-items:center; color:#fff; font-size:13px }
.settings-controls input{ margin-right:6px; }

@media (prefers-reduced-motion: reduce){
  .cell-match-pop, .cell-power-create, .cell-bomb-explode, .cell-swap-tap, .cell-hint-ping::after{ animation:none !important; }
  .particle{ display:none !important; }
}

/* Allow JS-driven reduced-motion toggle via body class `.cca-reduced-motion` */
.cca-reduced-motion .cell-match-pop, .cca-reduced-motion .cell-power-create, .cca-reduced-motion .cell-bomb-explode, .cca-reduced-motion .cell-swap-tap, .cca-reduced-motion .cell-hint-ping::after{ animation:none !important; }
.cca-reduced-motion .particle{ display:none !important; }

/* ===== MENU STYLES ===== */
.menu-container{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  pointer-events: auto;
}

.menu-panel{
  background: linear-gradient(180deg, #2b3034 0%, #3b4146 35%, #2f3539 100%);
  border: 1px solid rgba(220,225,230,0.06);
  border-radius: 20px;
  padding: 60px 40px;
  text-align: center;
  box-shadow: 0 20px 80px rgba(0,0,0,0.8), inset 0 1px 1px rgba(255,255,255,0.05);
  max-width: 500px;
  animation: fadeIn 0.6s ease-out;
}

.notification {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 20px 40px;
  border-radius: 10px;
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  z-index: 2000;
  animation: notificationFade 2s ease-out forwards;
}

@keyframes notificationFade {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

.menu-panel h2{
  margin: 0 0 10px 0;
  font-size: 48px;
  color: #dfe9ff;
  text-shadow: 0 2px 10px rgba(139,108,255,0.3);
}

.menu-subtitle{
  margin: 0 0 40px 0;
  font-size: 18px;
  color: #a9c1ff;
  opacity: 0.9;
}

.menu-buttons{
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.btn-large{
  padding: 18px 40px !important;
  font-size: 18px !important;
  font-weight: 600;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.btn-large:hover{
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(139,108,255,0.4) !important;
}

.btn-large:active{
  transform: translateY(-1px);
}

/* Modal styles */
.modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  opacity: 1;
  transition: opacity 0.3s ease;
  pointer-events: auto;
}

.modal.hidden{
  display: none;
  opacity: 0;
  pointer-events: none;
}

.modal-content{
  background: linear-gradient(180deg, #2b3034 0%, #3b4146 35%, #2f3539 100%);
  border: 1px solid rgba(220,225,230,0.06);
  border-radius: 20px;
  padding: 40px;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 80px rgba(0,0,0,0.8);
  position: relative;
}

.modal-content h2{
  margin: 0 0 30px 0;
  color: #dfe9ff;
  font-size: 32px;
}

.instructions-text{
  color: #a9c1ff;
  line-height: 1.8;
  margin-bottom: 30px;
}

.instructions-text p{
  margin: 10px 0;
}

.instructions-text ul{
  margin: 15px 0;
  padding-left: 30px;
}

.instructions-text li{
  margin: 10px 0;
}

.instructions-text strong{
  color: #dfe9ff;
}

.btn-close{
  position: absolute;
  top: 20px;
  right: 20px;
  background: none;
  border: none;
  color: #a9c1ff;
  font-size: 28px;
  cursor: pointer;
  padding: 0;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.3s ease;
}

.btn-close:hover{
  color: #dfe9ff;
}

/* Game container */
#game-container{
  width: 100%;
  max-width: 760px;
  padding: 12px;
  transition: opacity 0.3s ease;
  opacity: 1;
  pointer-events: auto;
}

#game-container.hidden{
  display: none;
  opacity: 0;
  pointer-events: none;

#board-root{
  transition: opacity 0.6s ease, transform 0.5s ease, filter 0.5s ease;
}
#board-root.story-cutscene-hidden{
  opacity: 0;
  transform: scale(0.95);
  filter: blur(20px);
  pointer-events: none;
}
.story-active #game-root,
.story-active #board-root{
  pointer-events: none;
}
}

@keyframes fadeIn{
  from{
    opacity: 0;
    transform: scale(0.95);
  }
  to{
    opacity: 1;
    transform: scale(1);
  }
}

.hidden{
  display: none !important;
}

/* Moving ships and astronauts - decorative background elements */
.moving-ship{
  position: absolute;
  pointer-events: none;
  z-index: 8;
}

.ship-1{
  width: 80px;
  height: 32px;
  top: 20%;
  left: -100px;
  background: linear-gradient(90deg, rgba(255,255,255,0.88) 0%, rgba(200,240,255,0.85) 40%, rgba(150,180,255,0.6) 100%);
  clip-path: polygon(0 50%, 75% 0, 100% 50%, 75% 100%);
  box-shadow: 0 8px 25px rgba(80,140,200,0.2), 0 0 35px rgba(139,200,255,0.3);
  animation: moving-ship-1 25s linear infinite;
  filter: drop-shadow(0 0 12px rgba(139,200,255,0.4));
}

.ship-2{
  width: 65px;
  height: 26px;
  top: 65%;
  right: -100px;
  background: linear-gradient(90deg, rgba(255,200,220,0.92) 0%, rgba(255,150,180,0.85) 60%);
  clip-path: polygon(0 50%, 70% 0, 100% 50%, 70% 100%);
  box-shadow: 0 8px 20px rgba(200,100,150,0.18), 0 0 30px rgba(255,150,200,0.25);
  animation: moving-ship-2 28s linear infinite;
  filter: drop-shadow(0 0 10px rgba(255,150,200,0.4));
}

.moving-astronaut{
  position: absolute;
  pointer-events: none;
  z-index: 7;
  border-radius: 50%;
}

.astro-1{
  width: 120px;
  height: 120px;
  top: 30%;
  left: -60px;
  background: radial-gradient(circle at 30% 30%, rgba(100,220,255,0.7), rgba(100,200,255,0.25));
  box-shadow: 0 0 50px rgba(100,220,255,0.6), inset 0 0 30px rgba(100,220,255,0.3);
  animation: moving-astro-1 22s ease-in-out infinite;
}

.astro-2{
  width: 100px;
  height: 100px;
  top: 55%;
  right: -50px;
  background: radial-gradient(circle at 30% 30%, rgba(180,150,255,0.65), rgba(180,150,255,0.2));
  box-shadow: 0 0 45px rgba(180,150,255,0.55), inset 0 0 25px rgba(180,150,255,0.25);
  animation: moving-astro-2 26s ease-in-out infinite;
}

@keyframes moving-ship-1{
  0%{ left: -100px; }
  100%{ left: 100vw; }
}

@keyframes moving-ship-2{
  0%{ right: -100px; }
  100%{ right: 100vw; }
}

@keyframes moving-astro-1{
  0%{ left: -60px; transform: scale(0.8); opacity: 0.4; }
  50%{ transform: scale(1.1); opacity: 0.8; }
  100%{ left: 100vw; transform: scale(0.8); opacity: 0.4; }
}

@keyframes moving-astro-2{
  0%{ right: -50px; transform: scale(0.85); opacity: 0.45; }
  50%{ transform: scale(1.05); opacity: 0.85; }
  100%{ right: 100vw; transform: scale(0.85); opacity: 0.45; }
}
