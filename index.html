<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Candy Crush Alien ‚Äî Prototype</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
        <div id="debug-panel" style="position:fixed;top:10px;right:10px;z-index:1000;background:rgba(20,20,40,0.92);padding:10px 16px;border-radius:10px;box-shadow:0 2px 12px #0006;display:none;gap:8px;flex-direction:column;">
          <b style="color:#fff176;font-size:1.1em;">DEBUG Power-Ups</b>
          <button onclick="window.CCA_ui && window.CCA_ui.forcePower('bomb')">B Bomb</button>
          <button onclick="window.CCA_ui && window.CCA_ui.forcePower('colorbomb')">C Colorbomb</button>
          <button onclick="window.CCA_ui && window.CCA_ui.forcePower('wrapped')">W Wrapped</button>
          <button onclick="window.CCA_ui && window.CCA_ui.toggleDebugPanel()" style="margin-top:6px;font-size:0.9em;">Cerrar</button>
        </div>
        <button id="show-debug-btn" style="position:fixed;top:10px;right:10px;z-index:999;background:#fff176;color:#222;padding:6px 14px;border-radius:8px;border:none;box-shadow:0 2px 8px #0004;cursor:pointer;">Debug</button>
    <canvas id="bg-canvas" style="position:fixed;inset:0;z-index:-1;pointer-events:none;"></canvas>
    <div id="space-bg" aria-hidden="true">
      <div class="planet p1" aria-hidden="true"></div>
      <div class="planet p2" aria-hidden="true"></div>
      <div class="planet p3" aria-hidden="true"></div>
      <div class="sun" aria-hidden="true"></div>
      <div class="ship s1" aria-hidden="true"></div>
      <div class="ship s2" aria-hidden="true"></div>
      <div class="moving-ship ship-1" aria-hidden="true"></div>
      <div class="moving-ship ship-2" aria-hidden="true"></div>
      <div class="moving-astronaut astro-1" aria-hidden="true"></div>
      <div class="moving-astronaut astro-2" aria-hidden="true"></div>
      <div class="nebula neb1" aria-hidden="true"></div>
      <div class="nebula neb2" aria-hidden="true"></div>
      <div class="milkyway" aria-hidden="true"></div>
      <div class="stars-small"></div>
      <div class="stars-mid"></div>
      <div class="sun"></div>
      <!-- Concept-specific layered placeholders (controlled by backgrounds.js) -->
      <div class="bg-concept-layers" aria-hidden="true">
        <div class="silhouette hangar" aria-hidden="true"></div>
        <div class="silhouette base" aria-hidden="true"></div>
        <div class="astronauts" aria-hidden="true"></div>
        <div class="drones" aria-hidden="true"></div>
      </div>
      <!-- Decorative side figures placed here so they stay behind the board -->
      <div class="side-figure left" id="side-left" aria-hidden="true"></div>
      <div class="side-figure right" id="side-right" aria-hidden="true"></div>
    </div>
    <header>
      <h1>Candy Crush Alien ‚Äî Prototype</h1>
      <p class="subtitle">Match-3 prototype (alien theme). Phase 2: project scaffold.</p>
    </header>
    <div id="notification" class="notification" style="display:none;"></div>

    <main>
      <!-- Main Menu -->
      <div id="main-menu" class="menu-container">
        <div class="menu-panel">
          <div id="menu-stats" style="position: absolute; top: 20px; right: 20px; display: flex; gap: 15px; font-family: 'Courier New', monospace;">
            <div class="stat-pill"><span id="menu-lives">‚ù§Ô∏è 5</span></div>
            <div class="stat-pill"><span id="menu-coins">ü™ô 0</span></div>
          </div>
          <h2>Candy Crush Alien</h2>
          <p class="menu-subtitle">Match 3 Alien Adventure</p>
          <div class="menu-buttons">
            <button id="btn-continue" class="btn btn-large">Continue</button>
            <button id="btn-new-game" class="btn btn-large">New Game</button>
            <button id="btn-level-selector" class="btn btn-large" style="background: #4a148c; border-color: #7b1fa2;">Level Selector (Dev)</button>
            <button id="btn-instructions" class="btn btn-large">Instructions</button>
            <button id="btn-settings" class="btn btn-large">Settings</button>
          </div>
        </div>
      </div>

      <!-- Instructions Modal -->
      <div id="instructions-modal" class="modal hidden">
        <div class="modal-content">
          <button id="btn-close-instructions" class="btn-close">&times;</button>
          <h2>How to Play</h2>
          <div class="instructions-text">
            <p><strong>Objective:</strong> Match 3 or more tiles of the same type to eliminate them.</p>
            <ul>
              <li><strong>Swap:</strong> Click or drag two adjacent tiles to swap them</li>
              <li><strong>Match:</strong> Arrange tiles in a row or column of 3 or more</li>
              <li><strong>Power-ups:</strong>
                <ul>
                  <li><strong>Bomb (4 in a row):</strong> Eliminates nearby tiles</li>
                  <li><strong>Wrapped (T or L shape):</strong> Creates a 3x3 explosion</li>
                  <li><strong>Color Bomb (5+ in a row):</strong> Eliminates all tiles of a color</li>
                </ul>
              </li>
              <li><strong>Score:</strong> Earn points for each match and advance to new levels</li>
            </ul>
          </div>
          <button id="btn-back-menu" class="btn">Back to Menu</button>
        </div>
      </div>

      <!-- Level Selector Modal -->
      <div id="level-selector-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
          <button id="btn-close-level-selector" class="btn-close">&times;</button>
          <h2>Level Selector (Dev Mode)</h2>
          <div id="level-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; max-height: 400px; overflow-y: auto; padding: 10px;">
            <!-- Levels will be injected here -->
          </div>
          <button id="btn-back-menu-levels" class="btn">Back to Menu</button>
        </div>
      </div>

      <!-- Pause Menu -->
      <div id="pause-menu" class="modal hidden">
        <div class="modal-content pause-panel">
          <h2>‚è∏Ô∏è Game Paused</h2>
          <div class="pause-buttons">
            <button id="btn-resume" class="btn btn-large btn-primary">‚ñ∂Ô∏è Resume</button>
            <button id="btn-restart-level" class="btn btn-large">Restart Level</button>
            <button id="btn-quit-level" class="btn btn-large">Quit to Menu</button>
          </div>
        </div>
      </div>

      <!-- Pre-Level Screen (replaces booster modal) -->
      <div id="pre-level-screen" class="modal hidden">
        <div class="modal-content pre-level-panel">
          <div class="level-header">
            <h2 id="pre-level-number">Level 1</h2>
            <div id="pre-level-name" class="level-name">First Contact</div>
          </div>
          
          <div class="objective-preview">
            <div class="objective-title">Objective</div>
            <div id="pre-level-objective" class="objective-description">
              <span class="objective-icon">üéØ</span>
              <span class="objective-text">Reach 300 points</span>
            </div>
            <div id="pre-level-moves" class="moves-info">
              <span class="moves-icon">‚è±Ô∏è</span>
              <span class="moves-text">30 moves available</span>
            </div>
          </div>
          
          <div class="boosters-section">
            <h3>Power-ups</h3>
            <p class="section-subtitle">Boost your chances with special items</p>
            <div id="pre-level-boosters" class="booster-grid">
              <!-- Boosters will be populated by JavaScript -->
            </div>
          </div>
          
          <div class="modal-actions">
            <button id="btn-start-level" class="btn btn-large btn-primary">üöÄ Start Level</button>
          </div>
        </div>
      </div>

      <!-- Game Screen (initially hidden) -->
      <div id="game-container" class="hidden">
        <div id="game-root">
        <!-- Board and UI live here. Side figures moved to #space-bg to avoid overlapping the board. -->
        <div id="board-header" class="panel">
          <!-- Economy HUD -->
          <div id="economy-hud" class="economy-panel">
            <div class="economy-item" id="lives-display">
              <span class="icon">‚ù§Ô∏è</span>
              <span id="lives-count">5</span>
              <span id="lives-timer" class="timer-text">Full</span>
            </div>
            <div class="economy-item" id="coins-display">
              <span class="icon">üí∞</span>
              <span id="coins-count">100</span>
            </div>
            <div class="economy-item" id="stars-display">
              <span class="icon">‚≠ê</span>
              <span id="stars-count">0</span>
            </div>
          </div>
          
          <div id="hud">
            <button id="btn-pause" class="btn-icon" title="Pause">‚è∏Ô∏è</button>
            <div id="score">Score: <span id="score-value">0</span></div>
            <div id="moves">Moves: <span id="moves-value">0</span></div>
            <div id="level">Level: <span id="level-value">1</span></div>
            <div id="objective-display" style="padding:4px 8px; background:transparent; border-radius:4px; border:1px solid #6dd5ff; font-weight:400; color:#aabbdd; font-size:0.9em; min-width:150px; text-align:center; display:none;">Objective</div>
          </div>
          <div id="controls">
            <button id="btn-start" class="btn">Start</button>
            <button id="btn-reset" class="btn">Reset</button>
            <button id="btn-shuffle" class="btn">Shuffle</button>
              <div class="theme-controls">
                <label for="bg-theme-select">Fondo</label>
                <select id="bg-theme-select" aria-label="Seleccionar tema de fondo">
                  <option value="deep_nebula">Deep Nebula</option>
                  <option value="alien_green">Alien Green</option>
                  <option value="cosmic_blue">Cosmic Blue</option>
                  <option value="void_dark">Void Dark</option>
                  <option value="inferno">Inferno</option>
                  <option value="station_orbit">Station Orbit</option>
                  <option value="aurora">Aurora</option>
                  <option value="galaxy_core">Galaxy Core</option>
                  <option value="binary_sunset">Binary Sunset</option>
                  <option value="quantum_realm">Quantum Realm</option>
                </select>
            </div>
            <div class="settings-controls" aria-label="Game settings">
              <label for="sfx-toggle"><input id="sfx-toggle" type="checkbox" checked /> SFX</label>
              <label for="music-toggle" style="margin-left:8px"><input id="music-toggle" type="checkbox" checked /> Music</label>
              <label for="reduced-motion-toggle" style="margin-left:8px"><input id="reduced-motion-toggle" type="checkbox" /> Reduced motion</label>
            </div>
            <div id="audio-controls" class="audio-controls">
              <button id="btn-play-music" class="btn">Play Music</button>
              <button id="btn-test-tone" class="btn">Test Tone</button>
              <button id="btn-mute" class="btn">Mute</button>
              <label for="volume">Vol</label>
              <input id="volume" type="range" min="0" max="100" value="60" />
            </div>
          </div>
        </div>

        <div id="board-root"></div>
        </div>
      </div>
    </main>

    <script type="module" src="src/game.js"></script>
      <script>
      // Debug panel logic
      document.getElementById('show-debug-btn').onclick = function() {
        document.getElementById('debug-panel').style.display = 'flex';
      };
      </script>
  </body>
</html>
